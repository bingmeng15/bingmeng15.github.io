if(document.querySelector("#bber-loading")){var loading_pic=document.getElementById("bber-loading");loading_pic.innerHTML='<span id="moments_loading"><i class="fa fa-spinner fa-spin"></i></span>'}function urlToLink(a){return a=(a=a.replace(/\bhttps?:[^:<>"]*\/([^:<>"]*)(\.(jpeg)|(png)|(jpg)|(webp))/g,(function(a){return'<a href="'+a+'"><img src="'+a+'" /></a>'}))).replace(/\bhttps?:\/\/(?!\S+(?:jpe?g|png|bmp|gif|webp|gif))\S+/g,(function(a){return" <a href='"+a+"'rel='noopener' target='_blank'>↘链接↙</a> "})),a=qqWechatEmotionParser(a)}document.querySelector("#bber")&&app.auth({persistence:"local"}).anonymousAuthProvider().signIn().then((()=>{var a="#bber";$(a).after('<div class="load"><button class="load-btn button-load">加载中……</button></div>');const t=app.database().collection("talks");var e=0,o=1;function n(){if(!(9*(o-1)>=e)){var n,r="";t.limit(9).skip(9*(o-1)).orderBy("date","desc").get((function(t,i){i.data.forEach((a=>{var t,e,o,i,l,s,c,d,f,p,m,u,g,b,h,v,y;n=a.date,data=n.getFullYear()+"/"+(n.getMonth()+1)+"/"+n.getDate()+" "+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds(),data1=(t=data,e=new Date,new Date(t),o=e.getTime()-(v=t.split(/[/ :]/),y=new Date(v[0],v[1]-1,v[2],v[3],v[4],v[5]),Date.parse(y)),f=12*(d=4*(c=7*(s=24*(l=60*(i=6e4))))),p=Math.floor(o/f),m=Math.floor(o/d),u=Math.floor(o/c),g=Math.floor(o/s),b=Math.floor(o/l),h=Math.floor(o/i),p<100&&p>0?"发表于"+p+"年前":m<12&&m>0?m+"月前":u<4&&u>0?u+"星期前":g<7&&g>0?g+"天前":b<24&&b>0?b+"小时前":0==h?"刚刚发表":h+"分钟前"),dataTime='<p class="datatime"title="'+data+'">'+data1+"</p>",dataCont='<p class="datacont">'+urlToLink(a.content)+"</p>";var M="";M=-1!=a.from.indexOf("iPhone")?'<i class="fas fa-mobile-alt"></i>':-1!=a.from.indexOf("iPad")?'<i class="fas fa-tablet-alt"></i>':-1!=a.from.indexOf("MacBook")?'<i class="fas fa-laptop"></i>':-1!=a.from.indexOf("微信")?'<i class="fab fa-weixin" style="font-size: 12px"></i>':'<i class="fas fa-tools"></i>',dataFrom=a.from?'<p class="datafrom"><small>'+M+a.from+"</small></p>":"",r+='<li class="item"><div>'+dataTime+dataCont+dataFrom+"</div></li>"})),$(a).append('<section class="timeline page-'+o+'"><ul><div class="list">'+r+"</div></ul></section>"),$("button.button-load").text("加载更多"),9*o>=e?$(".load").remove():(o++,Lately({target:"#bber .datatime"}))}))}}t.count((function(t,o){e=o.total,loading_pic.innerHTML="",$(a).append('<p class="count">共 <span class="count-data">'+e+"</span> 条</p>"),n()})),$(".button-load").click((function(){$(".button-load").text("加载中……"),n()}))})).catch((a=>{console.log(a)}));var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.arrayIteratorImpl=function(a){var t=0;return function(){return t<a.length?{done:!1,value:a[t++]}:{done:!0}}},$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}},$jscomp.makeIterator=function(a){var t="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return t?t.call(a):$jscomp.arrayIterator(a)},function(a,t){var e=function(){return this||(0,eval)("this")}();"Lately"in e||(e.Lately=function(a){for(var t=a.lang||{second:"秒",minute:"分钟",hour:"小时",day:"天",month:"个月",year:"年",ago:"前",error:"NaN"},e=(a=$jscomp.makeIterator(document.querySelectorAll(a.target||".time"))).next();!e.done;e=a.next()){var o=(e=e.value).dateTime,n=e.title,r=e.innerHTML;if(!o||isNaN(new Date(o=o.replace(/(.*)[a-z](.*)\+(.*)/gi,"$1 $2").replace(/-/g,"/"))))if(n&&!isNaN(new Date(n=n.replace(/-/g,"/"))))o=n;else{if(!r||isNaN(new Date(r=r.replace(/-/g,"/"))))break;o=r}e.title=o,o=new Date(o);var i=(r=(n=(o=((new Date).getTime()-o.getTime())/1e3)/60)/60)/24,l=i/30,s=l/12;e.innerHTML=(1<=s?Math.floor(s)+t.year:1<=l?Math.floor(l)+t.month:1<=i?Math.floor(i)+t.day:1<=r?Math.floor(r)+t.hour:1<=n?Math.floor(n)+t.minute:1<=o?Math.floor(o)+t.second:t.error)+t.ago}})}();